# ‚úÖ JWT –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!

## üéâ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–Ø —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä–∏–ª –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —Å Supabase –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç BroCar:

### ‚ú® –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **API Routes:**
   - ‚úÖ `app/api/auth/signout/route.ts` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
   - ‚úÖ `app/api/profile/route.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º (GET/PATCH)

2. **–°—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - ‚úÖ `app/profile/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - üîÑ `app/auth/login/page.tsx` - —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞
   - üîÑ `app/auth/register/page.tsx` - —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞
   - üîÑ `app/dashboard/page.tsx` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞

3. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
   - ‚úÖ `components/logout-button.tsx` - –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
   - üîÑ `components/header.tsx` - –æ–±–Ω–æ–≤–ª–µ–Ω (–º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + JWT —Å—Ç–∞—Ç—É—Å)

4. **–£—Ç–∏–ª–∏—Ç—ã:**
   - ‚úÖ `lib/api-auth.ts` - middleware –¥–ª—è –∑–∞—â–∏—Ç—ã API endpoints
   - üîÑ `lib/auth.ts` - —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞
   - üîÑ `lib/supabase/client.ts` - —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞
   - üîÑ `lib/supabase/server.ts` - —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞

5. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - ‚úÖ `supabase-auth-schema.sql` - —Å—Ö–µ–º–∞ —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏
   - ‚úÖ `lib/db/schema.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ profiles

6. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - ‚úÖ `docs/JWT_AUTH_GUIDE.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ (200+ —Å—Ç—Ä–æ–∫)
   - ‚úÖ `docs/QUICK_START.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Supabase

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Project URL** –∏ **anon key**

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `.env.local`:

```bash
# Supabase Configuration
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# Public Supabase
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here

# Database
DATABASE_URL=postgresql://postgres:password@db.your-project.supabase.co:5432/postgres
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase

–û—Ç–∫—Ä–æ–π—Ç–µ **Supabase SQL Editor** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

1. –°–Ω–∞—á–∞–ª–∞: `supabase-schema.sql` (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∏)
2. –ó–∞—Ç–µ–º: `supabase-auth-schema.sql` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç

```bash
npm run dev
```

### –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/auth/register
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: `test@test.com`)
3. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ http://localhost:3000/auth/login
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ Header –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞—à email –∏ "JWT –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"
   - ‚úÖ http://localhost:3000/dashboard - –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
   - ‚úÖ http://localhost:3000/profile - –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - ‚úÖ –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã" —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîê –ß—Ç–æ —Ç–∞–∫–æ–µ JWT –∏ –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### JWT (JSON Web Token) - —ç—Ç–æ:

–¢–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyLWlkIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.signature
‚îÇ                                      ‚îÇ                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Payload ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ Signature
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç (email + –ø–∞—Ä–æ–ª—å)
         ‚Üì
2. Supabase –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
         ‚Üì
3. Supabase –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω
         ‚Üì
4. JWT —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ httpOnly cookie (–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
         ‚Üì
5. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è JWT
         ‚Üì
6. Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT
         ‚Üì
7. PostgreSQL –ø–æ–ª—É—á–∞–µ—Ç JWT ‚Üí RLS —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
```

### üõ°Ô∏è Row Level Security (RLS)

**–≠—Ç–æ –º–∞–≥–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!**

RLS - —ç—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ PostgreSQL, –∫–æ—Ç–æ—Ä—ã–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ:

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã
CREATE POLICY "Users can view own orders"
  ON orders
  FOR SELECT
  USING (auth.uid() = user_id);
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- –ö–æ–≥–¥–∞ –≤—ã –¥–µ–ª–∞–µ—Ç–µ `SELECT * FROM orders`
- PostgreSQL **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –¥–æ–±–∞–≤–ª—è–µ—Ç `WHERE user_id = current_user_id`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–Ω–µ –º–æ–∂–µ—Ç** –ø–æ–ª—É—á–∏—Ç—å —á—É–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–∞–∂–µ –µ—Å–ª–∏ –æ—á–µ–Ω—å –ø–æ—Å—Ç–∞—Ä–∞–µ—Ç—Å—è!

---

## üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ó–∞—â–∏—Ç–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É

```typescript
// app/my-page/page.tsx
import { redirect } from "next/navigation";
import { getUser } from "@/lib/auth";

export default async function MyPage() {
  const user = await getUser();

  if (!user) {
    redirect("/auth/login"); // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≤—Ö–æ–¥
  }

  return <div>–ü—Ä–∏–≤–µ—Ç, {user.email}!</div>;
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ó–∞—â–∏—Ç–∏—Ç—å API endpoint

```typescript
// app/api/my-data/route.ts
import { withAuth } from "@/lib/api-auth";
import { NextResponse } from "next/server";

export const GET = withAuth(async (request, { user }) => {
  // user - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω –∏–∑ JWT
  return NextResponse.json({
    message: "–≠—Ç–æ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
    user_id: user.id,
    email: user.email,
  });
});
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

```typescript
// components/my-component.tsx
"use client";

import { createClient } from "@/lib/supabase/client";
import { useEffect, useState } from "react";

export function MyComponent() {
  const [user, setUser] = useState(null);

  useEffect(() => {
    const supabase = createClient();
    
    supabase.auth.getUser().then(({ data: { user } }) => {
      setUser(user);
    });
  }, []);

  return <div>{user ? user.email : "–ì–æ—Å—Ç—å"}</div>;
}
```

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

| –ú–∞—Ä—à—Ä—É—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–∞—â–∏—â–µ–Ω–æ |
|---------|----------|----------|
| `/auth/login` | –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É | ‚ùå |
| `/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | ‚ùå |
| `/dashboard` | –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | ‚úÖ JWT |
| `/profile` | –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ JWT |
| `/api/profile` | API –ø—Ä–æ—Ñ–∏–ª—è | ‚úÖ JWT |
| `/api/order` | API –∑–∞–∫–∞–∑–æ–≤ | ‚úÖ JWT + RLS |
| `/api/auth/signout` | –í—ã—Ö–æ–¥ | ‚úÖ JWT |

---

## üîß API Endpoints

### `GET /api/profile`
–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl http://localhost:3000/api/profile \
  -H "Cookie: sb-access-token=..."
```

### `PATCH /api/profile`
–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

```bash
curl -X PATCH http://localhost:3000/api/profile \
  -H "Content-Type: application/json" \
  -H "Cookie: sb-access-token=..." \
  -d '{"full_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", "phone": "+7 900 123 45 67"}'
```

### `POST /api/auth/signout`
–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

```bash
curl -X POST http://localhost:3000/api/auth/signout
```

---

## üé® UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Header —Å JWT —Å—Ç–∞—Ç—É—Å–æ–º

Header —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- ‚úÖ Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
- ‚úÖ –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é: –ü—Ä–æ—Ñ–∏–ª—å, –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "JWT –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"
- ‚úÖ –ö–Ω–æ–ø–∫–∏ "–í–æ–π—Ç–∏" –∏ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è" (–µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è

- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ email (–Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å)
- ‚úÖ –°—Ç–∞—Ç—É—Å JWT —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API

---

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
üìÑ `docs/JWT_AUTH_GUIDE.md` - 400+ —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- FAQ

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
üìÑ `docs/QUICK_START.md` - –∑–∞–ø—É—Å–∫ –∑–∞ 5 –º–∏–Ω—É—Ç

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ:

1. **JWT —Ç–æ–∫–µ–Ω—ã –≤ httpOnly cookies** - JavaScript –Ω–µ –º–æ–∂–µ—Ç –∏—Ö —É–∫—Ä–∞—Å—Ç—å
2. **RLS –ø–æ–ª–∏—Ç–∏–∫–∏** - –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
3. **Middleware** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
4. **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** - Supabase –æ–±–Ω–æ–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** - –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–≤–µ—Ä—è–µ–º –∫–ª–∏–µ–Ω—Ç—É

### üõ°Ô∏è RLS –ü–æ–ª–∏—Ç–∏–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –¥–ª—è:

- ‚úÖ `profiles` - –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ `orders` - –∑–∞–∫–∞–∑—ã
- ‚úÖ `carts` - –∫–æ—Ä–∑–∏–Ω—ã
- ‚úÖ `cart_items` - —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–∞—Ö

---

## üéì –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–í—Ö–æ–¥

```
–ö–ª–∏–µ–Ω—Ç                Supabase              PostgreSQL
   ‚îÇ                      ‚îÇ                      ‚îÇ
   ‚îú‚îÄ‚ñ∫ signUp/signIn ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ                      ‚îÇ
   ‚îÇ                      ‚îú‚îÄ‚ñ∫ –ü—Ä–æ–≤–µ—Ä–∫–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ
   ‚îÇ                      ‚îÇ‚óÑ‚îÄ‚îÄ OK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ‚óÑ‚îÄ JWT —Ç–æ–∫–µ–Ω ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                      ‚îÇ
   ‚îÇ  (httpOnly cookie)   ‚îÇ                      ‚îÇ
```

### 2. –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å

```
–ö–ª–∏–µ–Ω—Ç                Middleware            Supabase              PostgreSQL
   ‚îÇ                      ‚îÇ                      ‚îÇ                      ‚îÇ
   ‚îú‚îÄ‚ñ∫ GET /dashboard ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ                      ‚îÇ                      ‚îÇ
   ‚îÇ  (+ JWT cookie)      ‚îú‚îÄ‚ñ∫ –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ                      ‚îÇ
   ‚îÇ                      ‚îÇ‚óÑ‚îÄ‚îÄ User OK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                      ‚îÇ
   ‚îÇ                      ‚îú‚îÄ‚ñ∫ –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ
   ‚îÇ                      ‚îÇ                      ‚îÇ  RLS: WHERE user_id=X‚îÇ
   ‚îÇ                      ‚îÇ‚óÑ‚îÄ‚îÄ –î–∞–Ω–Ω—ã–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                      ‚îÇ                      ‚îÇ
```

### 3. RLS –≤ –¥–µ–π—Å—Ç–≤–∏–∏

```sql
-- –í—ã –ø–∏—à–µ—Ç–µ:
SELECT * FROM orders;

-- PostgreSQL –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
SELECT * FROM orders WHERE user_id = auth.uid();
-- auth.uid() –±–µ—Ä–µ—Ç—Å—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞!
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JWT —Ç–æ–∫–µ–Ω

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Application ‚Üí Cookies:
- –ò—â–∏—Ç–µ `sb-access-token` –∏ `sb-refresh-token`

### –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

```typescript
import { getSession } from "@/lib/auth";

const session = await getSession();
console.log("JWT:", session?.access_token);
console.log("User:", session?.user);
console.log("Expires:", new Date(session?.expires_at || 0));
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS

–í Supabase SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∫–ª—é—á–µ–Ω –ª–∏ RLS
SELECT tablename, rowsecurity 
FROM pg_tables 
WHERE schemaname = 'public';

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏
SELECT * FROM pg_policies WHERE schemaname = 'public';
```

---

## ‚ùì FAQ

**Q: –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è JWT —Ç–æ–∫–µ–Ω?**  
A: –í httpOnly cookie `sb-access-token`. –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º.

**Q: –ö–∞–∫ –¥–æ–ª–≥–æ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–∫–µ–Ω?**  
A: –û–±—ã—á–Ω–æ 1 —á–∞—Å. Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ refresh token.

**Q: –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ª–∏ —ç—Ç–æ?**  
A: –î–∞! httpOnly cookies + RLS = –¥–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞. JavaScript –Ω–µ –º–æ–∂–µ—Ç —É–∫—Ä–∞—Å—Ç—å —Ç–æ–∫–µ–Ω, –∞ RLS –∑–∞—â–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î.

**Q: –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å API endpoint?**  
A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `withAuth()` –∏–∑ `@/lib/api-auth`:
```typescript
export const GET = withAuth(async (req, { user }) => {
  return NextResponse.json({ data: "protected" });
});
```

**Q: –ß—Ç–æ —Ç–∞–∫–æ–µ RLS?**  
A: Row Level Security - —ç—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ PostgreSQL, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ `user_id` –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞.

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–í–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. ‚úÖ –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ `docs/JWT_AUTH_GUIDE.md` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env.local` —Å –≤–∞—à–∏–º–∏ –∫–ª—é—á–∞–º–∏ Supabase
3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç—ã –≤ Supabase
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –≤—Ö–æ–¥
5. ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–∏ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ API endpoints

---

**–£–¥–∞—á–∏! –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å - —á–∏—Ç–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `docs/` üìö**

